---
apiVersion: metal.sidero.dev/v1alpha1
kind: ServerClass
metadata:
  name: serverclass-x86-worker
spec:
  selector:
    matchExpressions:
      - key: controlplane
        operator: NotIn
        values: ["true"]
  qualifiers:
    systemInformation:
      - manufacturer: "Intel(R) Client Systems"
        version: "K61339-306"
      - manufacturer: LENOVO
        version: "ThinkCentre M715q"
  bootFromDiskMethod: ipxe-sanboot
  configPatches:
    - op: replace
      path: /machine/install/disk
      value: /dev/sda
    - op: replace
      path: /machine/install/bootloader
      value: true
    - op: add
      path: /machine/install/extensions
      value: [{"image": "ghcr.io/siderolabs/iscsi-tools:v0.1.1"}]
    - op: replace
      path: /cluster/allowSchedulingOnControlPlanes
      value: true
    - op: add
      path: /cluster/network/cni
      value:
        name: custom
        urls:
          - https://raw.githubusercontent.com/rtrox/home-cluster/main/provision/sidero/custom/cni/cilium-base-install.yaml
    - op: add
      path: /machine/sysctls
      value:
        vm.nr_hugepages: "1024"
