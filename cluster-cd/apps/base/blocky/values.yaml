---

image:
  # repository: spx01/blocky
  # tag: development@sha256:ddb35986cbc924de11cd37ccf625ff6bd0896fad456e57ee9c0bd67bd034770e
  repository: tccr.io/truecharts/blocky
  tag: v0.19@sha256:77a474542f12f480deca33ff0a6375846918b86988c13f858620839d8818ca84
  pullPolicy: IfNotPresent

WebUIImage:
  repository: tccr.io/truecharts/blocky-frontend
  tag: v0.0.3@sha256:81058f20520dcdb80c9883b6f21b338446fefc333e3ca8bd7d17336a24a5d842
  pullPolicy: IfNotPresent

k8sgatewayImage:
  repository: tccr.io/truecharts/k8s_gateway
  pullPolicy: IfNotPresent
  tag: 0.3.2@sha256:594fd6990eb2e0af1df7df8ba76cb3ca66232f46c5df5ebf786a45dd19777ae5


controller:
  replicas: 3
  strategy: RollingUpdate

blockyConfig:
  upstream:
    default:
      - tcp+udp:10.0.7.1
      # - tcp+udp:8.8.8.8
      # - tcp+udp:8.8.4.4
      # - tcp+udp:1.1.1.1
      # - tcp-tls:1.0.0.1:853
      # - https://cloudflare-dns.com/dns-query
  conditional:
    mapping:
      # local: tcp+udp:10.0.7.1
      # home: tcp+udp:10.0.7.1
      status.eviljungle.com: tcp+udp:1.1.1.1
      cloud.eviljungle.com: tcp+udp:8.8.8.8
      # eviljungle.com: tcp+udp:10.0.6.99
  blocking:
    blackLists:
      ads:
        - https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
        - https://s3.amazonaws.com/lists.disconnect.me/simple_ad.txt
        - http://sysctl.org/cameleon/hosts
        - https://s3.amazonaws.com/lists.disconnect.me/simple_tracking.txt
        - https://raw.githubusercontent.com/kboghdady/youTube_ads_4_pi-hole/master/youtubelist.txt
      kid-safe:
        - https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/fakenews-gambling-porn/hosts
      none:
    whiteLists:
      ads:
        - https://raw.githubusercontent.com/billimek/k8s-gitops/master/default/blocky/whitelist.txt
    clientGroupsBlock:
      default:
        - ads
      172.16.0.0/12:
        - ads
      12a06:a003:4018::/48:
        - ads
      192.168.0.0/16:
        - ads
      192.168.4.1/24:
        - ads
        - kid-safe
    blockType: zeroIp
  prometheus:
    enable: true
    path: /metrics
  httpPort: 4000
  logLevel: info

webUI:
  enabled: true

hostsFile:
  enabled: false

caching:
  minTime: 5m
  maxTime: 30m
  maxItemsCount: 0
  prefetching: false
  prefetchExpires: 2h
  prefetchThreshold: 5
  prefetchMaxItemsCount: 0
  cacheTimeNegative: 30m

# -- set bootstrap dns (not needed)
# Ensures bootstrap encryption and ensure it doesn't use k8s dns
bootstrapDns:
  # -- Upstream
  upstream: ""
  # -- IP's linked to upstream DoT/DoH DNS name
  ips: []

# -- Return empty answer for these queries
filtering:
  # -- Ensures filtering by query type
  queryTypes: []

# -- Set manual custom DNS resolution
customDNS:
  customTTL: 1h
  filterUnmappedTypes: true
  rewrite: []
  # - in: something.com
  #   out: somethingelse.com
  mapping: []
  # - domain: something.com
  #   dnsserver: 192.168.178.1

# -- Setup client-name lookup
clientLookup:
  # -- upstream used for client-name lookup
  upstream: ""
  singleNameOrder: []
  clients: []
  # - domain: laptop
  #   ips: []

# -- set conditional settings
# Primarily designed for inclusion in the TrueNAS SCALE GUI
conditional:
  rewrite: []
  # - in: something.com
  #   out: somethingelse.com
  mapping: []
  # - domain: something.com
  #   dnsserver: 192.168.178.1

# -- set blocking settings using Lists
# Primarily designed for inclusion in the TrueNAS SCALE GUI
blocking:
  # -- Sets the blocktype
  blockType: nxDomain
  # -- Sets the block ttl
  blockTTL: 6h
  # -- Sets the block refreshPeriod
  refreshPeriod: 4h
  # -- Sets the block download timeout
  downloadTimeout: 60s
  # -- Sets the block download attempt count
  downloadAttempts: 3
  # -- Sets the block download cooldown
  downloadCooldown: 2s
  # -- Set to fail start of lists cannot be downloaded
  failStartOnListError: false
  # -- Sets how many list-groups can be processed at the same time
  processingConcurrency: 4
  # --  Add blocky whitelists
  whitelist: []
  #  - name: ads
  #    lists:
  #      - https://someurl.com/list.txt
  #      - /somefile.txt

  # -- Blocky blacklists
  blacklist: []
  # - name: ads
  #   lists:
  #     - https://someurl.com/list.txt
  #     - /somefile.txt

  # -- Blocky clientGroupsBlock
  clientGroupsBlock: []
  # - name: default
  #   groups:
  #     - ads

probes:
  liveness:
    enabled: false
    # TODO: Enable after v0.20 is released.
    # Current version does not include the healthcheck command
    # enabled: true
    # custom: true
    # spec:
    #   exec:
    #     command:
    #       - /app/blocky
    #       - healthcheck
  readiness:
    enabled: false
    # TODO: Enable after v0.20 is released.
    # Current version does not include the healthcheck command
    # enabled: true
    # custom: true
    # spec:
    #   exec:
    #     command:
    #       - /app/blocky
    #       - healthcheck
  startup:
    enabled: false
    # TODO: Enable after v0.20 is released.
    # Current version does not include the healthcheck command
    # enabled: true
    # custom: true
    # spec:
    #   exec:
    #     command:
    #       - /app/blocky
    #       - healthcheck

service:
  main:
    ports:
      main:
        port: 10315
        protocol: HTTP
        targetPort: 80
  dnstcp:
    enabled: true
    ports:
      dnstcp:
        enabled: true
        port: 53
        targetPort: 53
  dnsudp:
    enabled: true
    ports:
      dnsudp:
        enabled: true
        port: 53
        protocol: UDP
        targetPort: 53
  dot:
    enabled: true
    ports:
      dot:
        enabled: true
        port: 853
        protocol: TCP
        targetPort: 853
  http:
    enabled: true
    ports:
      http:
        enabled: true
        port: 4000
        protocol: HTTP
        targetPort: 4000
  https:
    enabled: true
    ports:
      https:
        enabled: true
        port: 4443
        protocol: HTTPS
        targetPort: 4443
  k8sgateway:
    enabled: false

k8sgateway:
  enabled: false

metrics:
  enabled: true
  serviceMonitor:
    interval: 1m
    scrapeTimeout: 30s
    labels:
      cluster: ${CLUSTER_NAME}
  prometheusRule:
    enabled: false
    labels: {}
    # -- Configure additionial rules for the chart under this key.
    # @default -- See prometheusrules.yaml
    rules:

redis:
  enabled: true
  existingSecret: rediscreds
